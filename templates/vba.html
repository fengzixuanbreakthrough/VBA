<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	<meta charset="utf-8">
	<title>二代架构工具使用</title>
	<link href="static/bootstrap-3.3.5-dist/css/bootstrap.min.css" title="" rel="stylesheet" />
	<link title="" href="static/css/style.css" rel="stylesheet" type="text/css" />
	<link title="blue" href="static/css/dermadefault.css" rel="stylesheet" type="text/css" />
	<link title="green" href="static/css/dermagreen.css" rel="stylesheet" type="text/css" disabled="disabled" />
	<link title="orange" href="static/css/dermaorange.css" rel="stylesheet" type="text/css" disabled="disabled" />
	<link href="static/css/templatecss.css" rel="stylesheet" title="" type="text/css" />

	<link href="static/bootstrap-3.3.5-dist/css/bootstrap-select.min.css" title="" rel="stylesheet" />
	<link href="static/bootstrap-3.3.5-dist/js/bootstrap-select.min.js" title="" rel="stylesheet" />

	<script src="static/js/jquery-1.11.1.min.js" type="text/javascript"></script>
	<script src="static/js/jquery.cookie.js" type="text/javascript"></script>
	<script src="static/bootstrap-3.3.5-dist/js/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
	<nav class="nav navbar-default navbar-mystyle navbar-fixed-top">
		<div class="navbar-header">
			<button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand mystyle-brand"><span class="glyphicon glyphicon-home"></span></a>
		</div>
		<div class="collapse navbar-collapse">
			<ul class="nav navbar-nav">
				<li class="li-border"><a class="mystyle-color" href="#">二代架构工具</a></li>
			</ul>

			<ul class="nav navbar-nav pull-right">
				<li class="li-border">

				</li>

				<li class="dropdown li-border"><a href="#" class="dropdown-toggle mystyle-color"
						data-toggle="dropdown">帮助文档<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="javascript:location.href = '/help';">帮助文档</a></li>

					</ul>
				</li>
				<li class="dropdown li-border"><a href="#" class="dropdown-toggle mystyle-color"
						data-toggle="dropdown">欢迎您<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="javascript:location.href = '/';">退出</a></li>
					</ul>
				</li>
				<li class="dropdown"><a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown">换肤<span
							class="caret"></span></a>
					<ul class="dropdown-menu changecolor">
						<li id="blue"><a href="#">蓝色</a></li>
						<li class="divider"></li>
						<li id="green"><a href="#">绿色</a></li>
						<li class="divider"></li>
						<li id="orange"><a href="#">橙色</a></li>
					</ul>
				</li>
			</ul>
		</div>
	</nav>
	<div class="down-main">
		<div class="left-main left-full">
			<div class="sidebar-fold"><span class="glyphicon glyphicon-menu-hamburger"></span></div>
			<div class="subNavBox">
				<div class="sBox">

					<ul class="navContent" style="display:block">
						<!-- <li>
            <div class="showtitle" style="width:100px;"><img src="static/img/leftimg.png" />账号管理</div>
            <a href="javascript:location.href = '/index';"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">账号管理</span></a> </li>
          <li class="active">
            <div class="showtitle" style="width:100px;"><img src="static/img/leftimg.png" />路由测试</div>
            <a href="javascript:location.href = '/gateway';"><span class="sublist-icon glyphicon glyphicon-fullscreen"></span><span class="sub-title">路由测试</span></a> </li> -->
						<li class="active">
							<div class="showtitle" style="width:100px;"><img src="static/img/leftimg.png" />文件转换</div>
							<a href="javascript:location.href = '/changefile';"><span
									class="sublist-icon glyphicon glyphicon-file"></span><span
									class="sub-title">文件转换</span></a>
						</li>

						<!-- <li>
            <div class="showtitle" style="width:100px;"><img src="static/img/leftimg.png" />上传记录</div>
            <a href="javascript:location.href = '/history';"><span class="sublist-icon glyphicon glyphicon-folder-open"></span><span class="sub-title">上传记录</span></a></li> -->
					</ul>
				</div>

			</div>
		</div>
		<div class="right-product view-product right-full">
			<div class="container-fluid">
				<form action="/Setting/general" method="post" autocomplete="off" draggable="false" id="convertfirst">
					<div class="manage account-manage info-center">
						<div class="page-header">
							<div class="pull-left">
								<h4>FDR文档转换</h4>
							</div>
						</div>


						<ul class="accound-bund">
							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">选择文件</span>
								<span class="w45">
									<input type="file" name="firstFDR" class="col-lg-6 form-control" style="float:left;"
										accept=".doc" />

								</span>
							</li>

							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">文件名字</span>
								<span class="w45">
									<input id="version" name="FDRFirstName" data-form="version" type="version"
										class="col-lg-6 form-control" placeholder='输入生成的目标Excel文件名，通常为主功能名称+版本号。' />
								</span>
							</li>
							<li class="clearfix" style="padding: 0px" ;>
								<input name="submit" class="col-lg-6 form-control" type="button" id="submit" value="生成"
									style="width:200px;margin: 0px 20px 0px 20px" onclick="convertfirst()" />

								<input name="submit" class="col-lg-6 form-control" type="button" id="submit"
									value="下载文件" style="width:200px;margin: 0px 20px 0px 20px;"
									onclick="downloadfirst()" />


							</li>
						</ul>
						<div style="background-color:white">
							<ol id="resultlist1" style="list-style:none;">
							</ol>
						</div>
				</form>
				<form action="/Setting/general" method="post" autocomplete="off" draggable="false" id="convertsecond">
					<div class="page-header" style="border:none;">
						<div class="pull-left">
							<h4>FDR与法规、UC的追溯关系</h4>
							<h6>&nbsp&nbsp&nbsp选择文件前请将前一步生成的FDR文档增加法规的追溯关系及UC的追溯关系，具体操作见帮助文档</h6>
						</div>
					</div>

					<ul class="accound-bund">

						<li class="clearfix">


							<span class="bund-class" style="font-size:15px">选择文件</span>
							<span class="w45">
								<input type="file" name="secondFDR" class="col-lg-6 form-control" style="float:left;"
									accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel " />
							</span>
						</li>


						<li class="clearfix" style="padding: 0px">
							<input name="submit" class="col-lg-6 form-control" type="button" id="submit" value="ID转换"
								style="width:200px;margin: 0px 20px 0px 20px" onclick="convertID()" />

							<input name="submit" class="col-lg-6 form-control" type="button" id="submit" value="关联法规"
								style="width:200px;margin: 0px 20px 0px 20px;" onclick="relativeLaws()" />
							<input name="submit" class="col-lg-6 form-control" type="button" id="submit" value="关联UC"
								style="width:200px;margin: 0px 20px 0px 20px;" onclick="relativeUC()" />
							<input name="submit" class="col-lg-6 form-control" type="button" id="submit" value="下载文件"
								style="width:200px;margin: 0px 20px 0px 20px;" onclick="downloadsecond()" />
						</li>
					</ul>
				</form>
				<!-- <form action='/save' method='post' data-ajax="false" enctype="multipart/form-data">
						<ul class="accound-bund">
							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">上传asc文件</span>
								<span class="w45">
									<input type="file" name="asc" style="float:left;" accept=".asc" />
								</span>



							</li>

							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">上传HTML文件</span>
								<span class="w45">
									<input type="file" name="html2" style="float:left;" accept=".html" />
								</span>



							</li>


							<li class="clearfix">

								<button class="btn btn-info btn-block" data-form="submit">上传</button>

							</li>
						</ul>
					</form> -->
				<!-- {% if noasc%}
					<script type="text/javascript">alert("请上传asc文件");</script>
					{% endif %}

					{% if noresult%}
					<script type="text/javascript">alert("请上传html文件");</script>
					{% endif %}

					{% if success_save%}
					<script type="text/javascript">alert("留档成功");</script>
					{% endif %} -->




				<!-- <form action='/gateway' method='post' data-ajax="false" enctype="multipart/form-data">


						<ul class="accound-bund">
							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">项目名称</span>
								<span class="w45">
									<select name="progamname" value="1" class="col-lg-6 form-control">



										<option value="J6">J6</option>
										<option value="JH6">JH6</option>
										<option value="J7 1代">J7 1代</option>
										<option value="J7 1.5代">J7 1.5代</option>


									</select></span>
							</li>


							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">版本编号</span>
								<span class="w45">
									<input id="version" name="version" data-form="version" type="version"
										class="col-lg-6 form-control" placeholder='请输入版本编号' />
								</span>
							</li>

							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">测试描述</span>
								<span class="w45">
									<textarea name="discribe" rows="3" cols="20" class="col-lg-6 form-control"
										placeholder='请输入测试描述'></textarea>
								</span>
							</li>

							<li class="clearfix">
								<span class="bund-class" style="font-size:15px">选择文件</span>
								<span class="w45">
									<input type="file" name="gatewaylist" class="col-lg-6 form-control"
										style="float:left;" accept=".xls" />
								</span>
							</li>

							<li class="clearfix">

								<button class="btn btn-info btn-block" data-form="submit"
									style="width:606px;">生成配置文件</button>

							</li>

						</ul> -->

				<div style="background-color:white">
					<ol id="resultlist2" style="list-style:none;">
					</ol>
				</div>

				<!-- 
					</form>

					{% if error1%}
					<script type="text/javascript">alert("有选项未填写，请填写完全");</script>
					{% endif %}

					{% if error2%}
					<script type="text/javascript">alert("文件未上传，请上传");</script>
					{% endif %} -->
			</div>
		</div>
	</div>
	</div>
	<script type="text/javascript">

		$(function () {
			/*换肤*/
			$(".dropdown .changecolor li").click(function () {
				var style = $(this).attr("id");
				$("link[title!='']").attr("disabled", "disabled");
				$("link[title='" + style + "']").removeAttr("disabled");

				$.cookie('mystyle', style, { expires: 7 }); // 存储一个带7天期限的 cookie 
			})
			var cookie_style = $.cookie("mystyle");
			if (cookie_style != null) {
				$("link[title!='']").attr("disabled", "disabled");
				$("link[title='" + cookie_style + "']").removeAttr("disabled");
			}
			/*左侧导航栏显示隐藏功能*/
			$(".subNav").click(function () {
				/*显示*/
				if ($(this).find("span:first-child").attr('class') == "title-icon glyphicon glyphicon-chevron-down") {
					$(this).find("span:first-child").removeClass("glyphicon-chevron-down");
					$(this).find("span:first-child").addClass("glyphicon-chevron-up");
					$(this).removeClass("sublist-down");
					$(this).addClass("sublist-up");
				}
				/*隐藏*/
				else {
					$(this).find("span:first-child").removeClass("glyphicon-chevron-up");
					$(this).find("span:first-child").addClass("glyphicon-chevron-down");
					$(this).removeClass("sublist-up");
					$(this).addClass("sublist-down");
				}
				// 修改数字控制速度， slideUp(500)控制卷起速度
				$(this).next(".navContent").slideToggle(300).siblings(".navContent").slideUp(300);
			})
			/*左侧导航栏缩进功能*/
			$(".left-main .sidebar-fold").click(function () {

				if ($(this).parent().attr('class') == "left-main left-full") {
					$(this).parent().removeClass("left-full");
					$(this).parent().addClass("left-off");

					$(this).parent().parent().find(".right-product").removeClass("right-full");
					$(this).parent().parent().find(".right-product").addClass("right-off");

				}
				else {
					$(this).parent().removeClass("left-off");
					$(this).parent().addClass("left-full");

					$(this).parent().parent().find(".right-product").removeClass("right-off");
					$(this).parent().parent().find(".right-product").addClass("right-full");

				}
			})

			/*左侧鼠标移入提示功能*/
			$(".sBox ul li").mouseenter(function () {
				if ($(this).find("span:last-child").css("display") == "none") { $(this).find("div").show(); }
			}).mouseleave(function () { $(this).find("div").hide(); })
		})
	</script>
	<script>
		function convertfirst() {
			//上传
			var formdata = new FormData($("#convertfirst")[0])//初始化一个表单对象
			$("#resultlist1").empty();
			$("#resultlist1").append('<li>').append("正在生成").append('</li>')
			$.ajax({
				url: "/vabfirst",//上传地址
				type: "POST",//post上传
				data: formdata,//数据
				processData: false,
				contentType: false,
				cache: false,
				success: function (data) {
					//console.log(data)
					if (data.length == 0) {
						//alert("上传成功,并且无错误")
						$("#resultlist1").append('<li>').append("生成成功").append('</li>')


					}
					else {

						//alert("上传成功,显示错误如下")
						$.each(data, function (index) {
							$("#resultlist1").append('<li>').append(data[index]).append('</li>')

						})
					}


				},
				error: function () {
					alert("上传失败")
					$("#resultlist1").append('<li>').append("上传失败").append('</li>')
				}
			});
		}
		function downloadfirst() {
			var url = "/downloadfirst";
			var xhr = new XMLHttpRequest();
			xhr.cache = false;
			xhr.open('GET', url, true);        // 也可以使用POST方式，根据接口
			xhr.responseType = "blob";    // 返回类型blob
			// 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑
			xhr.onload = function () {
				// 请求完成
				if (this.status === 200) {
					// 返回200
					var blob = this.response;
					var reader = new FileReader();
					reader.readAsDataURL(blob);    // 转换为base64，可以直接放入a表情href
					reader.onload = function (e) {
						// 转换完成，创建一个a标签用于下载
						var a = document.createElement('a');
						a.href = "/downloadfirst";
						$("body").append(a);    // 修复firefox中无法触发click
						a.click();
						$(a).remove();
					}
				}
				else {
					alert("下载失败")
					$("#resultlist1").append('<li>').append("下载失败").append('</li>')
				}
			};
			// 发送ajax请求
			xhr.send()
		}
		function convertID() {
			//上传
			var formdata = new FormData($("#convertsecond")[0])//初始化一个表单对象
			$("#resultlist2").empty();
			$("#resultlist2").append('<li>').append("正在转换ID").append('</li>')
			$.ajax({
				url: "/vabsecond",//上传地址
				type: "POST",//post上传
				data: formdata,//数据
				processData: false,
				contentType: false,
				cache: false,
				success: function (data) {
					//console.log(data)
					if (data.length == 0) {
						//alert("上传成功,并且无错误")
						$("#resultlist2").append('<li>').append("转换ID成功").append('</li>')


					}
					else {

						//alert("上传成功,显示错误如下")
						$.each(data, function (index) {
							$("#resultlist2").append('<li>').append(data[index]).append('</li>')

						})
					}


				},
				error: function () {
					alert("转换ID失败")
					$("#resultlist1").append('<li>').append("转换ID失败").append('</li>')
				}
			});
		}
		function relativeLaws() {
			//上传
			// var formdata = new FormData($("#convertsecond")[0])//初始化一个表单对象
			$("#resultlist2").empty();
			$("#resultlist2").append('<li>').append("正在关联法规").append('</li>')
			$.ajax({
				url: "/relativeLaws",//上传地址
				type: "POST",//post上传
				// data: formdata,//数据
				processData: false,
				contentType: false,
				cache: false,
				success: function (data) {
					//console.log(data)
					if (data.length == 0) {
						//alert("上传成功,并且无错误")
						$("#resultlist2").append('<li>').append("关联法规成功").append('</li>')


					}
					else {

						//alert("上传成功,显示错误如下")
						$.each(data, function (index) {
							$("#resultlist2").append('<li>').append(data[index]).append('</li>')

						})
					}


				},
				error: function () {
					alert("关联法规失败")
					$("#resultlist2").append('<li>').append("关联法规失败").append('</li>')
				}
			});
		}
		function relativeUC() {
			//上传
			var formdata = new FormData($("#convertsecond")[0])//初始化一个表单对象
			$("#resultlist2").empty();
			$("#resultlist2").append('<li>').append("正在关联UC").append('</li>')
			$.ajax({
				url: "/relativeUC",//上传地址
				type: "POST",//post上传
				data: formdata,//数据
				processData: false,
				contentType: false,
				cache: false,
				success: function (data) {
					//console.log(data)
					if (data.length == 0) {
						//alert("上传成功,并且无错误")
						$("#resultlist2").append('<li>').append("关联UC成功").append('</li>')


					}
					else {

						//alert("上传成功,显示错误如下")
						$.each(data, function (index) {
							$("#resultlist2").append('<li>').append(data[index]).append('</li>')

						})
					}


				},
				error: function () {
					alert("关联UC失败")
					$("#resultlist2").append('<li>').append("关联UC失败").append('</li>')
				}
			});
		}
		function downloadsecond() {
			var url = "/downloadsecond";
			var xhr = new XMLHttpRequest();
			xhr.cache = false;
			xhr.open('GET', url, true);        // 也可以使用POST方式，根据接口
			xhr.responseType = "blob";    // 返回类型blob
			// 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑
			xhr.onload = function () {
				// 请求完成
				if (this.status === 200) {
					// 返回200
					var blob = this.response;
					var reader = new FileReader();
					reader.readAsDataURL(blob);    // 转换为base64，可以直接放入a表情href
					reader.onload = function (e) {
						// 转换完成，创建一个a标签用于下载
						var a = document.createElement('a');
						a.href = "/downloadsecond";
						$("body").append(a);    // 修复firefox中无法触发click
						a.click();
						$(a).remove();
					}
				}
				else {
					alert("下载失败")
					$("#resultlist2").append('<li>').append("下载失败").append('</li>')
				}
			};
			// 发送ajax请求
			xhr.send()
		}
	</script>
</body>

</html>